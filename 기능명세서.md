# ê»Œë”±ì§€ì›”ë“œ ì„œë²„ êµ¬í˜„ ëª…ì„¸ì„œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

ì¡¸ì—…ì „ì‹œ "ê»Œë”±ì§€ì›”ë“œ"ì˜ ë°±ì—”ë“œ ì„œë²„

* **ì—­í• ** : ëª¨ë‹ˆí„° í• ë‹¹ ë° ìƒíƒœ ê´€ë¦¬
* **ê¸°ìˆ ** : Node.js + Express + Socket.io
* **ë°°í¬** : Railway
* **DB** : Supabase (PostgreSQL)

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Core

* **Runtime** : Node.js 20.x LTS
* **Framework** : Express 4.x
* **WebSocket** : Socket.io 4.x
* **Database Client** : @supabase/supabase-js 2.x

### Dependencies

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "socket.io": "^4.6.1",
    "@supabase/supabase-js": "^2.39.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.2"
  }
}
```

### í™˜ê²½ë³€ìˆ˜

```bash
# .env
PORT=3000
NODE_ENV=production
CORS_ORIGIN=https://ggumddi.vercel.app
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## ğŸ“Š Supabase DB ìŠ¤í‚¤ë§ˆ

### worries í…Œì´ë¸”

```sql
-- ê³ ë¯¼ ë°ì´í„° ì €ì¥
CREATE TABLE worries (
  id BIGSERIAL PRIMARY KEY,
  worry_image_url TEXT NOT NULL,           -- Storage íŒŒì¼ëª… (ì˜ˆ: "1735392000.jpg")
  worry_text TEXT,                         -- ê³ ë¯¼ ë‚´ìš© (ì„ íƒì‚¬í•­)
  submitted_at TIMESTAMPTZ DEFAULT NOW(),  -- ì œì¶œ ì‹œê°„
  displayed_at TIMESTAMPTZ,                -- ë¹”í”„ë¡œì í„° í‘œì‹œ ì‹œê°„
  monitor_id TEXT,                         -- ì²´í—˜í•œ ëª¨ë‹ˆí„° ("monitor-1" or "monitor-2")
  status TEXT DEFAULT 'displaying',        -- ìƒíƒœ ("displaying", "completed")
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤ (ë¹ ë¥¸ ì¡°íšŒ)
CREATE INDEX idx_worries_submitted_at ON worries(submitted_at DESC);
CREATE INDEX idx_worries_status ON worries(status);

-- RLS (Row Level Security) ë¹„í™œì„±í™” (ê³µê°œ ë°ì´í„°)
ALTER TABLE worries ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Enable read access for all users" ON worries FOR SELECT USING (true);
CREATE POLICY "Enable insert access for all users" ON worries FOR INSERT WITH CHECK (true);
CREATE POLICY "Enable update access for all users" ON worries FOR UPDATE USING (true);

-- Realtime í™œì„±í™”
ALTER PUBLICATION supabase_realtime ADD TABLE worries;
```

### Storage ë²„í‚·

```sql
-- Storage ë²„í‚· ì„¤ì • (Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ìƒì„±)
Bucket Name: worry-images
Public: true (ê³µê°œ ì ‘ê·¼)
File Size Limit: 1MB
Allowed MIME types: image/jpeg, image/png
```

---

## ğŸ¯ ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­

### 1. ëª¨ë‹ˆí„° í• ë‹¹ ì‹œìŠ¤í…œ

#### 1-1. ëª¨ë‹ˆí„° ìƒíƒœ ê´€ë¦¬

* 2ê°œì˜ ëª¨ë‹ˆí„° ìƒíƒœë¥¼ ë©”ëª¨ë¦¬ì—ì„œ ê´€ë¦¬
* ê° ëª¨ë‹ˆí„°ëŠ” `idle` ë˜ëŠ” `busy` ìƒíƒœ
* ìƒíƒœ êµ¬ì¡°:

```javascript
monitors = {
  'monitor-1': {
    status: 'idle',        // 'idle' | 'busy'
    currentWorry: null,    // { worryId, assignedAt }
    socketId: null         // ì—°ê²°ëœ ì†Œì¼“ ID
  },
  'monitor-2': {
    status: 'idle',
    currentWorry: null,
    socketId: null
  }
}
```

#### 1-2. í• ë‹¹ ë¡œì§

 **ì…ë ¥** : `{ worryId }` (íƒœë¸”ë¦¿ì—ì„œ ì „ì†¡)
 **ì²˜ë¦¬** :

1. ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë‹ˆí„° ì°¾ê¸° (status === 'idle')
2. ìˆìœ¼ë©´:
   * ëª¨ë‹ˆí„° ìƒíƒœë¥¼ `busy`ë¡œ ë³€ê²½
   * `currentWorry` ì €ì¥
   * íƒœë¸”ë¦¿ì— í• ë‹¹ ê²°ê³¼ ì „ì†¡
   * ëª¨ë‹ˆí„°ì— ì²´í—˜ ì‹œì‘ ì‹ í˜¸ ì „ì†¡
3. ì—†ìœ¼ë©´:
   * ëŒ€ê¸°ì—´ì— ì¶”ê°€
   * íƒœë¸”ë¦¿ì— ëŒ€ê¸° ì•ˆë‚´ ì „ì†¡

 **ì¶œë ¥** :

```javascript
// íƒœë¸”ë¦¿ìœ¼ë¡œ
{
  type: 'monitor-assigned',
  monitorId: 'monitor-1',
  monitorNumber: 1,  // 1 or 2
  message: 'ğŸ‘ˆ ì™¼ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê°€ì„¸ìš”'
}

// ë˜ëŠ”
{
  type: 'please-wait',
  queuePosition: 1,
  message: 'ğŸˆ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! (1ë²ˆì§¸)'
}

// ëª¨ë‹ˆí„°ë¡œ
{
  type: 'start-experience',
  worryId: '67abc123...'
}
```

#### 1-3. ì²´í—˜ ì™„ë£Œ ì²˜ë¦¬

 **ì…ë ¥** : `{ monitorId }` (ëª¨ë‹ˆí„°ì—ì„œ ì „ì†¡)
 **ì²˜ë¦¬** :

1. í•´ë‹¹ ëª¨ë‹ˆí„° ìƒíƒœë¥¼ `idle`ë¡œ ë³€ê²½
2. `currentWorry`ë¥¼ nullë¡œ ì´ˆê¸°í™”
3. ëŒ€ê¸°ì—´ í™•ì¸
   * ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì ìˆìœ¼ë©´ ìë™ í• ë‹¹
   * ì—†ìœ¼ë©´ idle ìœ ì§€

---

### 2. ëŒ€ê¸°ì—´ ê´€ë¦¬

#### 2-1. ëŒ€ê¸°ì—´ êµ¬ì¡°

```javascript
waitingQueue = [
  {
    socketId: 'abc123',
    worryId: '67abc123...',
    timestamp: 1735392000000,
    timeoutId: setTimeout(...)  // 5ë¶„ íƒ€ì„ì•„ì›ƒ
  }
]
```

#### 2-2. ëŒ€ê¸°ì—´ ì¶”ê°€

* FIFO (First In First Out) ìˆœì„œ
* ì¶”ê°€ ì‹œ 5ë¶„ íƒ€ì„ì•„ì›ƒ ì„¤ì •
* 5ë¶„ ê²½ê³¼ ì‹œ ìë™ ì œê±° + íƒœë¸”ë¦¿ì— ë§Œë£Œ ì•Œë¦¼

#### 2-3. ëŒ€ê¸°ì—´ ì œê±°

* ëª¨ë‹ˆí„° í• ë‹¹ë˜ë©´ ì œê±°
* íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ ì œê±°
* ì†Œì¼“ ì—°ê²° ëŠê¸°ë©´ ì œê±°

#### 2-4. ìˆœì„œ ì—…ë°ì´íŠ¸

* ëŒ€ê¸°ì—´ ë³€ë™ ì‹œ ëª¨ë“  ëŒ€ê¸° ì¤‘ì¸ íƒœë¸”ë¦¿ì— ìˆœì„œ ì•Œë¦¼

```javascript
{
  type: 'queue-updated',
  queuePosition: 2  // ì—…ë°ì´íŠ¸ëœ ìˆœì„œ
}
```

---

### 3. ë””ë°”ì´ìŠ¤ ë“±ë¡ ì‹œìŠ¤í…œ

#### 3-1. ë””ë°”ì´ìŠ¤ íƒ€ì…

* `tablet`: íƒœë¸”ë¦¿ (ê³ ë¯¼ ì…ë ¥)
* `monitor-1`: ëª¨ë‹ˆí„° 1 (ì²´í—˜)
* `monitor-2`: ëª¨ë‹ˆí„° 2 (ì²´í—˜)
* `projector`: ë¹”í”„ë¡œì í„° (ëŒ€í˜• ìŠ¤í¬ë¦°)

#### 3-2. ë“±ë¡ ì´ë²¤íŠ¸

```javascript
socket.on('register-device', (deviceType) => {
  // deviceType: 'tablet' | 'monitor-1' | 'monitor-2' | 'projector'

  // Socket.io room ì°¸ê°€
  socket.join(deviceType);

  // ëª¨ë‹ˆí„°ì¸ ê²½ìš° ìƒíƒœ ê°ì²´ì— ì†Œì¼“ ID ì €ì¥
  if (deviceType.startsWith('monitor-')) {
    monitors[deviceType].socketId = socket.id;
  }

  // ë“±ë¡ ì™„ë£Œ ì‘ë‹µ
  socket.emit('registered', { deviceType });
});
```

---

### 4. ì—°ê²° ê´€ë¦¬

#### 4-1. ì—°ê²° ëŠê¹€ ì²˜ë¦¬

```javascript
socket.on('disconnect', () => {
  // 1. ëª¨ë‹ˆí„° ì—°ê²° ëŠê¹€
  const monitor = findMonitorBySocketId(socket.id);
  if (monitor) {
    // ìƒíƒœë¥¼ idleë¡œ ë³€ê²½
    monitors[monitor].status = 'idle';
    monitors[monitor].currentWorry = null;
    monitors[monitor].socketId = null;

    // ëŒ€ê¸°ì—´ í™•ì¸ (ë‹¤ìŒ ì‚¬ìš©ì í• ë‹¹í•˜ì§€ ì•ŠìŒ - ëª¨ë‹ˆí„° ì—†ìŒ)
  }

  // 2. íƒœë¸”ë¦¿ ì—°ê²° ëŠê¹€
  // ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
  waitingQueue = waitingQueue.filter(item => {
    if (item.socketId === socket.id) {
      clearTimeout(item.timeoutId);
      return false;
    }
    return true;
  });

  // ë‚¨ì€ ëŒ€ê¸°ìë“¤ì—ê²Œ ìˆœì„œ ì—…ë°ì´íŠ¸
  updateQueuePositions();
});
```

#### 4-2. ì¬ì—°ê²° ì²˜ë¦¬

* Socket.ioê°€ ìë™ìœ¼ë¡œ ì¬ì—°ê²° ì‹œë„
* ì„œë²„ëŠ” ê¸°ì¡´ ìƒíƒœ ìœ ì§€ (ë©”ëª¨ë¦¬)
* ëª¨ë‹ˆí„° ì¬ì—°ê²° ì‹œ:
  * `register-device` ë‹¤ì‹œ í˜¸ì¶œ
  * í´ë¼ì´ì–¸íŠ¸ localStorageì—ì„œ ë³µêµ¬

---

### 5. í—¬ìŠ¤ ì²´í¬

```javascript
app.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    timestamp: Date.now(),
    monitors: {
      'monitor-1': monitors['monitor-1'].status,
      'monitor-2': monitors['monitor-2'].status
    },
    queueLength: waitingQueue.length,
    uptime: process.uptime()
  });
});
```

---

## âš¡ ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­

### ì„±ëŠ¥

* **ì‘ë‹µ ì‹œê°„** : ëª¨ë‹ˆí„° í• ë‹¹ < 100ms
* **ë™ì‹œ ì ‘ì†** : ìµœì†Œ 50ëª… ë™ì‹œ ì²˜ë¦¬
* **WebSocket ì§€ì—°** : < 50ms (ë¡œì»¬ ë„¤íŠ¸ì›Œí¬)
* **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** : < 500MB

### ê°€ìš©ì„±

* **ì—…íƒ€ì„** : 99% (ì „ì‹œ ê¸°ê°„ 3ì¼)
* **ìë™ ì¬ì‹œì‘** : Railway ìë™ ì¬ì‹œì‘ í™œìš©
* **ì—ëŸ¬ ë³µêµ¬** : í¬ë˜ì‹œ ì‹œ 30ì´ˆ ë‚´ ë³µêµ¬

### í™•ì¥ì„±

* **ëª¨ë‹ˆí„° ì¶”ê°€** : ì½”ë“œ ìˆ˜ì • ìµœì†Œí™” (ì„¤ì •ìœ¼ë¡œ í™•ì¥)
* **ëŒ€ê¸°ì—´ í¬ê¸°** : ë¬´ì œí•œ (ë©”ëª¨ë¦¬ í—ˆìš© ë²”ìœ„)

### ë³´ì•ˆ

* **CORS** : Vercel ë„ë©”ì¸ë§Œ í—ˆìš©
* **Rate Limiting** : í•„ìš” ì‹œ ì¶”ê°€
* **í™˜ê²½ë³€ìˆ˜** : ë¯¼ê° ì •ë³´ ì•”í˜¸í™”

### ëª¨ë‹ˆí„°ë§

* **ë¡œê¹…** : ëª¨ë“  ì£¼ìš” ì´ë²¤íŠ¸ ë¡œê¹…
* **ì—ëŸ¬ ì¶”ì ** : console.errorë¡œ ì—ëŸ¬ ê¸°ë¡
* **ìƒíƒœ ëª¨ë‹ˆí„°ë§** : `/health` ì—”ë“œí¬ì¸íŠ¸

### ì½”ë“œ í’ˆì§ˆ

* **ê°€ë…ì„±** : ëª…í™•í•œ í•¨ìˆ˜ëª…, ì£¼ì„
* **ìœ ì§€ë³´ìˆ˜ì„±** : ëª¨ë“ˆí™”ëœ êµ¬ì¡°
* **í…ŒìŠ¤íŠ¸** : í•µì‹¬ ë¡œì§ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„ íƒ)

---

## ğŸ”„ ì£¼ìš” í”Œë¡œìš°

### Flow 1: ëª¨ë‹ˆí„° í• ë‹¹ (ì„±ê³µ)

```
[íƒœë¸”ë¦¿]                [ì„œë²„]                [ëª¨ë‹ˆí„°]
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€request-monitorâ”€â”€â”€â”€â”€â–¶â”‚                      â”‚
   â”‚  { worryId }          â”‚                      â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ 1. ë¹ˆ ëª¨ë‹ˆí„° ì°¾ê¸°     â”‚
   â”‚                      â”‚    (monitor-1 idle)  â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ 2. ìƒíƒœ ë³€ê²½         â”‚
   â”‚                      â”‚    status = 'busy'   â”‚
   â”‚                      â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€monitor-assignedâ”€â”‚                      â”‚
   â”‚  { monitorId: 1,     â”‚                      â”‚
   â”‚    message: "ì™¼ìª½" } â”‚                      â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚â”€â”€start-experienceâ”€â”€â”€â”€â–¶â”‚
   â”‚                      â”‚  { worryId }          â”‚
   â”‚                      â”‚                      â”‚
```

### Flow 2: ëª¨ë‹ˆí„° í• ë‹¹ (ëŒ€ê¸°)

```
[íƒœë¸”ë¦¿]                [ì„œë²„]
   â”‚                      â”‚
   â”‚â”€â”€request-monitorâ”€â”€â”€â”€â”€â–¶â”‚
   â”‚  { worryId }          â”‚
   â”‚                      â”‚
   â”‚                      â”‚ 1. ë¹ˆ ëª¨ë‹ˆí„° ì—†ìŒ
   â”‚                      â”‚    (ëª¨ë‘ busy)
   â”‚                      â”‚
   â”‚                      â”‚ 2. ëŒ€ê¸°ì—´ ì¶”ê°€
   â”‚                      â”‚    queue.push(...)
   â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€please-waitâ”€â”€â”€â”€â”€â”€â”‚
   â”‚  { queuePosition: 1, â”‚
   â”‚    message: "ëŒ€ê¸°" } â”‚
   â”‚                      â”‚
   â”‚                      â”‚ 3. 5ë¶„ íƒ€ì„ì•„ì›ƒ ì„¤ì •
   â”‚                      â”‚    setTimeout(...)
   â”‚                      â”‚
```

### Flow 3: ì²´í—˜ ì™„ë£Œ â†’ ë‹¤ìŒ ì‚¬ìš©ì í• ë‹¹

```
[ëª¨ë‹ˆí„°]               [ì„œë²„]                [íƒœë¸”ë¦¿(ëŒ€ê¸°ì¤‘)]
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€experience-completeâ”€â–¶â”‚                      â”‚
   â”‚  { monitorId: 1 }     â”‚                      â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ 1. ìƒíƒœ ë³€ê²½         â”‚
   â”‚                      â”‚    status = 'idle'   â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ 2. ëŒ€ê¸°ì—´ í™•ì¸       â”‚
   â”‚                      â”‚    queue[0] ìˆìŒ     â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ 3. í• ë‹¹              â”‚
   â”‚                      â”‚    status = 'busy'   â”‚
   â”‚                      â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€start-experienceâ”€â”‚                      â”‚
   â”‚  { worryId }          â”‚                      â”‚
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚â”€â”€monitor-assignedâ”€â”€â”€â”€â–¶â”‚
   â”‚                      â”‚  { monitorId: 1 }     â”‚
   â”‚                      â”‚                      â”‚
```

### Flow 4: ì„œë²„ ì¬ì‹œì‘ ë³µêµ¬

```
[ì„œë²„ ì¬ì‹œì‘]
   â”‚
   â”œâ”€ ë©”ëª¨ë¦¬ ì´ˆê¸°í™”
   â”‚  monitors = { idle, idle }
   â”‚  waitingQueue = []
   â”‚
   â”œâ”€ Express ì„œë²„ ì‹œì‘
   â”‚  PORT 3000 listen
   â”‚
   â””â”€ Socket.io ì¤€ë¹„
      â”‚
      â–¼
[í´ë¼ì´ì–¸íŠ¸ ì¬ì—°ê²°]
   â”‚
   â”œâ”€ [ëª¨ë‹ˆí„° 1, 2]
   â”‚  â”‚
   â”‚  â”œâ”€ Socket.io ìë™ ì¬ì—°ê²°
   â”‚  â”œâ”€ register-device('monitor-1')
   â”‚  â””â”€ í´ë¼ì´ì–¸íŠ¸ localStorageì—ì„œ ë³µêµ¬
   â”‚
   â”œâ”€ [íƒœë¸”ë¦¿]
   â”‚  â”‚
   â”‚  â”œâ”€ Socket.io ìë™ ì¬ì—°ê²°
   â”‚  â””â”€ ì…ë ¥ ì¤‘ì´ë˜ ë‚´ìš© ìœ ì§€
   â”‚
   â””â”€ [ë¹”í”„ë¡œì í„°]
      â”‚
      â”œâ”€ Socket.io ìë™ ì¬ì—°ê²°
      â”œâ”€ register-device('projector')
      â””â”€ Supabase Realtime ì¬êµ¬ë…
```

---

## ğŸ“¡ Socket.io ì´ë²¤íŠ¸ ëª…ì„¸

### í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„

#### 1. register-device

ë””ë°”ì´ìŠ¤ ë“±ë¡

```javascript
socket.emit('register-device', deviceType);
// deviceType: 'tablet' | 'monitor-1' | 'monitor-2' | 'projector'
```

#### 2. request-monitor

ëª¨ë‹ˆí„° í• ë‹¹ ìš”ì²­ (íƒœë¸”ë¦¿)

```javascript
socket.emit('request-monitor', {
  worryId: '67abc123...'
});
```

#### 3. experience-complete

ì²´í—˜ ì™„ë£Œ (ëª¨ë‹ˆí„°)

```javascript
socket.emit('experience-complete', monitorId);
// monitorId: 'monitor-1' | 'monitor-2'
```

---

### ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸

#### 1. registered

ë“±ë¡ ì™„ë£Œ ì‘ë‹µ

```javascript
socket.emit('registered', {
  deviceType: 'monitor-1',
  timestamp: Date.now()
});
```

#### 2. monitor-assigned

ëª¨ë‹ˆí„° í• ë‹¹ ì™„ë£Œ (íƒœë¸”ë¦¿ìœ¼ë¡œ)

```javascript
socket.emit('monitor-assigned', {
  monitorId: 'monitor-1',
  monitorNumber: 1,  // 1 or 2
  message: 'ğŸ‘ˆ ì™¼ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê°€ì„¸ìš”'
});
```

#### 3. start-experience

ì²´í—˜ ì‹œì‘ ì‹ í˜¸ (ëª¨ë‹ˆí„°ë¡œ)

```javascript
io.to('monitor-1').emit('start-experience', {
  worryId: '67abc123...'
});
```

#### 4. please-wait

ëŒ€ê¸° ì•ˆë‚´ (íƒœë¸”ë¦¿ìœ¼ë¡œ)

```javascript
socket.emit('please-wait', {
  queuePosition: 1,
  message: 'ğŸˆ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! (1ë²ˆì§¸)'
});
```

#### 5. queue-updated

ëŒ€ê¸°ì—´ ìˆœì„œ ì—…ë°ì´íŠ¸ (íƒœë¸”ë¦¿ìœ¼ë¡œ)

```javascript
socket.emit('queue-updated', {
  queuePosition: 2
});
```

#### 6. queue-expired

ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼ (íƒœë¸”ë¦¿ìœ¼ë¡œ)

```javascript
socket.emit('queue-expired', {
  message: 'â° ëŒ€ê¸° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
});
```

#### 7. error

ì—ëŸ¬ ë°œìƒ

```javascript
socket.emit('error', {
  code: 'MONITOR_NOT_FOUND',
  message: 'ëª¨ë‹ˆí„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”.'
});
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
server/
â”œâ”€â”€ .env                      # í™˜ê²½ë³€ìˆ˜
â”œâ”€â”€ .env.example              # í™˜ê²½ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ server.js                 # ë©”ì¸ ì§„ì…ì 
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ supabase.js       # Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ managers/
â”‚   â”‚   â”œâ”€â”€ MonitorManager.js # ëª¨ë‹ˆí„° ìƒíƒœ ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ QueueManager.js   # ëŒ€ê¸°ì—´ ê´€ë¦¬
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ deviceHandler.js  # ë””ë°”ì´ìŠ¤ ë“±ë¡ í•¸ë“¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ monitorHandler.js # ëª¨ë‹ˆí„° í• ë‹¹ í•¸ë“¤ëŸ¬
â”‚   â”‚   â””â”€â”€ disconnectHandler.js # ì—°ê²° ëŠê¹€ í•¸ë“¤ëŸ¬
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.js         # ë¡œê¹… ìœ í‹¸
â”‚       â””â”€â”€ constants.js      # ìƒìˆ˜ ì •ì˜
â””â”€â”€ tests/                    # í…ŒìŠ¤íŠ¸ (ì„ íƒ)
    â””â”€â”€ monitor.test.js
```

---

## ğŸ”§ í•µì‹¬ ëª¨ë“ˆ êµ¬í˜„ ê°€ì´ë“œ

### 1. MonitorManager.js

```javascript
/**
 * ëª¨ë‹ˆí„° ìƒíƒœ ê´€ë¦¬
 * - 2ê°œ ëª¨ë‹ˆí„°ì˜ ìƒíƒœ (idle/busy) ê´€ë¦¬
 * - ë¹ˆ ëª¨ë‹ˆí„° ì°¾ê¸°
 * - ìƒíƒœ ë³€ê²½
 */

class MonitorManager {
  constructor() {
    this.monitors = {
      'monitor-1': {
        status: 'idle',
        currentWorry: null,
        socketId: null
      },
      'monitor-2': {
        status: 'idle',
        currentWorry: null,
        socketId: null
      }
    };
  }

  /**
   * ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë‹ˆí„° ì°¾ê¸°
   * @returns {string|null} ëª¨ë‹ˆí„° ID ('monitor-1' or 'monitor-2') ë˜ëŠ” null
   */
  findAvailable() {
    for (const [id, monitor] of Object.entries(this.monitors)) {
      if (monitor.status === 'idle') {
        return id;
      }
    }
    return null;
  }

  /**
   * ëª¨ë‹ˆí„° í• ë‹¹
   * @param {string} monitorId - 'monitor-1' or 'monitor-2'
   * @param {object} worryData - { worryId, socketId }
   */
  assign(monitorId, worryData) {
    this.monitors[monitorId].status = 'busy';
    this.monitors[monitorId].currentWorry = {
      worryId: worryData.worryId,
      assignedAt: Date.now()
    };
    this.monitors[monitorId].socketId = worryData.socketId;
  }

  /**
   * ëª¨ë‹ˆí„° í•´ì œ
   * @param {string} monitorId
   */
  release(monitorId) {
    this.monitors[monitorId].status = 'idle';
    this.monitors[monitorId].currentWorry = null;
    // socketIdëŠ” ìœ ì§€ (ì¬í• ë‹¹ ì‹œ í•„ìš”)
  }

  /**
   * ì†Œì¼“ IDë¡œ ëª¨ë‹ˆí„° ì°¾ê¸°
   * @param {string} socketId
   * @returns {string|null} ëª¨ë‹ˆí„° ID ë˜ëŠ” null
   */
  findBySocketId(socketId) {
    for (const [id, monitor] of Object.entries(this.monitors)) {
      if (monitor.socketId === socketId) {
        return id;
      }
    }
    return null;
  }

  /**
   * ëª¨ë‹ˆí„° ì†Œì¼“ ID ì—…ë°ì´íŠ¸
   * @param {string} monitorId
   * @param {string} socketId
   */
  updateSocketId(monitorId, socketId) {
    this.monitors[monitorId].socketId = socketId;
  }

  /**
   * ì „ì²´ ìƒíƒœ ì¡°íšŒ
   * @returns {object} ëª¨ë‹ˆí„° ìƒíƒœ ê°ì²´
   */
  getStatus() {
    return {
      'monitor-1': this.monitors['monitor-1'].status,
      'monitor-2': this.monitors['monitor-2'].status
    };
  }
}

module.exports = MonitorManager;
```

---

### 2. QueueManager.js

```javascript
/**
 * ëŒ€ê¸°ì—´ ê´€ë¦¬
 * - FIFO ìˆœì„œ ìœ ì§€
 * - íƒ€ì„ì•„ì›ƒ ê´€ë¦¬ (5ë¶„)
 * - ìˆœì„œ ì—…ë°ì´íŠ¸
 */

class QueueItem {
  constructor(socketId, worryId) {
    this.socketId = socketId;
    this.worryId = worryId;
    this.timestamp = Date.now();
    this.timeoutId = null;
  }
}

class QueueManager {
  constructor() {
    this.queue = [];
    this.TIMEOUT_MS = 5 * 60 * 1000; // 5ë¶„
  }

  /**
   * ëŒ€ê¸°ì—´ ì¶”ê°€
   * @param {string} socketId
   * @param {string} worryId
   * @param {function} onTimeout - íƒ€ì„ì•„ì›ƒ ì½œë°±
   * @returns {number} ëŒ€ê¸° ìˆœì„œ (1ë¶€í„° ì‹œì‘)
   */
  add(socketId, worryId, onTimeout) {
    const item = new QueueItem(socketId, worryId);

    // íƒ€ì„ì•„ì›ƒ ì„¤ì •
    item.timeoutId = setTimeout(() => {
      this.remove(socketId);
      onTimeout(socketId);
    }, this.TIMEOUT_MS);

    this.queue.push(item);
    return this.queue.length; // ìˆœì„œ (1ë¶€í„°)
  }

  /**
   * ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
   * @param {string} socketId
   * @returns {boolean} ì œê±° ì„±ê³µ ì—¬ë¶€
   */
  remove(socketId) {
    const index = this.queue.findIndex(item => item.socketId === socketId);
    if (index !== -1) {
      const item = this.queue[index];
      clearTimeout(item.timeoutId);
      this.queue.splice(index, 1);
      return true;
    }
    return false;
  }

  /**
   * ë‹¤ìŒ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸° (FIFO)
   * @returns {object|null} { socketId, worryId } ë˜ëŠ” null
   */
  dequeue() {
    if (this.queue.length === 0) {
      return null;
    }

    const item = this.queue.shift();
    clearTimeout(item.timeoutId);

    return {
      socketId: item.socketId,
      worryId: item.worryId
    };
  }

  /**
   * ëŒ€ê¸°ì—´ ê¸¸ì´ ì¡°íšŒ
   * @returns {number}
   */
  getLength() {
    return this.queue.length;
  }

  /**
   * íŠ¹ì • ì†Œì¼“ì˜ ìˆœì„œ ì¡°íšŒ
   * @param {string} socketId
   * @returns {number|null} ìˆœì„œ (1ë¶€í„°) ë˜ëŠ” null
   */
  getPosition(socketId) {
    const index = this.queue.findIndex(item => item.socketId === socketId);
    return index !== -1 ? index + 1 : null;
  }

  /**
   * ì „ì²´ ì†Œì¼“ ID ëª©ë¡
   * @returns {string[]}
   */
  getAllSocketIds() {
    return this.queue.map(item => item.socketId);
  }

  /**
   * ëŒ€ê¸°ì—´ ì´ˆê¸°í™”
   */
  clear() {
    this.queue.forEach(item => clearTimeout(item.timeoutId));
    this.queue = [];
  }
}

module.exports = QueueManager;
```

---

### 3. server.js (ë©”ì¸)

```javascript
const express = require('express');
const http = require('http');
const socketIo = require('socket.io');
const cors = require('cors');
require('dotenv').config();

const MonitorManager = require('./src/managers/MonitorManager');
const QueueManager = require('./src/managers/QueueManager');
const logger = require('./src/utils/logger');

// Express ì•± ì„¤ì •
const app = express();
const server = http.createServer(app);

// CORS ì„¤ì •
app.use(cors({
  origin: process.env.CORS_ORIGIN || '*',
  credentials: true
}));

app.use(express.json());

// Socket.io ì„¤ì •
const io = socketIo(server, {
  cors: {
    origin: process.env.CORS_ORIGIN || '*',
    methods: ['GET', 'POST'],
    credentials: true
  },
  transports: ['websocket', 'polling']
});

// ë§¤ë‹ˆì € ì´ˆê¸°í™”
const monitorManager = new MonitorManager();
const queueManager = new QueueManager();

// ============================================
// REST API
// ============================================

// í—¬ìŠ¤ ì²´í¬
app.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    timestamp: Date.now(),
    monitors: monitorManager.getStatus(),
    queueLength: queueManager.getLength(),
    uptime: process.uptime()
  });
});

// ìƒíƒœ ì¡°íšŒ (ë””ë²„ê¹…ìš©)
app.get('/status', (req, res) => {
  res.json({
    monitors: monitorManager.monitors,
    queueLength: queueManager.getLength(),
    connectedClients: io.sockets.sockets.size
  });
});

// ============================================
// Socket.io ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
// ============================================

io.on('connection', (socket) => {
  logger.info('í´ë¼ì´ì–¸íŠ¸ ì—°ê²°:', socket.id);

  // 1. ë””ë°”ì´ìŠ¤ ë“±ë¡
  socket.on('register-device', (deviceType) => {
    logger.info(`ë””ë°”ì´ìŠ¤ ë“±ë¡: ${deviceType} (${socket.id})`);

    // Room ì°¸ê°€
    socket.join(deviceType);

    // ëª¨ë‹ˆí„°ì¸ ê²½ìš° ì†Œì¼“ ID ì €ì¥
    if (deviceType === 'monitor-1' || deviceType === 'monitor-2') {
      monitorManager.updateSocketId(deviceType, socket.id);
    }

    // ë“±ë¡ ì™„ë£Œ ì‘ë‹µ
    socket.emit('registered', {
      deviceType,
      timestamp: Date.now()
    });

    logger.info(`${deviceType} ë“±ë¡ ì™„ë£Œ`);
  });

  // 2. ëª¨ë‹ˆí„° í• ë‹¹ ìš”ì²­ (íƒœë¸”ë¦¿)
  socket.on('request-monitor', (data) => {
    const { worryId } = data;
    logger.info(`ëª¨ë‹ˆí„° ìš”ì²­: worryId=${worryId}, socket=${socket.id}`);

    // ë¹ˆ ëª¨ë‹ˆí„° ì°¾ê¸°
    const availableMonitor = monitorManager.findAvailable();

    if (availableMonitor) {
      // í• ë‹¹ ì„±ê³µ
      logger.info(`ëª¨ë‹ˆí„° í• ë‹¹: ${availableMonitor} â†’ worryId=${worryId}`);

      // ëª¨ë‹ˆí„° ìƒíƒœ ë³€ê²½
      monitorManager.assign(availableMonitor, {
        worryId,
        socketId: socket.id
      });

      // íƒœë¸”ë¦¿ì— í• ë‹¹ ê²°ê³¼ ì „ì†¡
      socket.emit('monitor-assigned', {
        monitorId: availableMonitor,
        monitorNumber: availableMonitor === 'monitor-1' ? 1 : 2,
        message: availableMonitor === 'monitor-1'
          ? 'ğŸ‘ˆ ì™¼ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê°€ì„¸ìš”'
          : 'ğŸ‘‰ ì˜¤ë¥¸ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê°€ì„¸ìš”'
      });

      // ëª¨ë‹ˆí„°ì— ì²´í—˜ ì‹œì‘ ì‹ í˜¸
      io.to(availableMonitor).emit('start-experience', {
        worryId
      });

    } else {
      // ëª¨ë‘ ì‚¬ìš© ì¤‘ â†’ ëŒ€ê¸°ì—´ ì¶”ê°€
      logger.info(`ëŒ€ê¸°ì—´ ì¶”ê°€: worryId=${worryId}`);

      const position = queueManager.add(
        socket.id,
        worryId,
        (expiredSocketId) => {
          // íƒ€ì„ì•„ì›ƒ ì½œë°±
          logger.warn(`ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼: socket=${expiredSocketId}`);
          io.to(expiredSocketId).emit('queue-expired', {
            message: 'â° ëŒ€ê¸° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
          });
        }
      );

      // ëŒ€ê¸° ì•ˆë‚´ ì „ì†¡
      socket.emit('please-wait', {
        queuePosition: position,
        message: `ğŸˆ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! (${position}ë²ˆì§¸)`
      });
    }
  });

  // 3. ì²´í—˜ ì™„ë£Œ (ëª¨ë‹ˆí„°)
  socket.on('experience-complete', (monitorId) => {
    logger.info(`ì²´í—˜ ì™„ë£Œ: ${monitorId}`);

    // ëª¨ë‹ˆí„° í•´ì œ
    monitorManager.release(monitorId);

    // ëŒ€ê¸°ì—´ í™•ì¸
    const nextUser = queueManager.dequeue();

    if (nextUser) {
      // ë‹¤ìŒ ì‚¬ìš©ì í• ë‹¹
      logger.info(`ë‹¤ìŒ ì‚¬ìš©ì í• ë‹¹: ${monitorId} â†’ worryId=${nextUser.worryId}`);

      monitorManager.assign(monitorId, nextUser);

      // íƒœë¸”ë¦¿ì— í• ë‹¹ ì•Œë¦¼
      io.to(nextUser.socketId).emit('monitor-assigned', {
        monitorId,
        monitorNumber: monitorId === 'monitor-1' ? 1 : 2,
        message: monitorId === 'monitor-1'
          ? 'ğŸŒŸ ê¸°ë‹¤ë ¤ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ğŸ‘ˆ ì™¼ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê³ ê³ !'
          : 'ğŸŒŸ ê¸°ë‹¤ë ¤ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ğŸ‘‰ ì˜¤ë¥¸ìª½ ê»Œë”±ì§€ì›”ë“œë¡œ ê³ ê³ !'
      });

      // ëª¨ë‹ˆí„°ì— ì²´í—˜ ì‹œì‘ ì‹ í˜¸
      io.to(monitorId).emit('start-experience', {
        worryId: nextUser.worryId
      });

      // ë‚¨ì€ ëŒ€ê¸°ìë“¤ì—ê²Œ ìˆœì„œ ì—…ë°ì´íŠ¸
      updateQueuePositions();
    } else {
      logger.info(`${monitorId} idle ìƒíƒœë¡œ ì „í™˜ (ëŒ€ê¸°ì—´ ì—†ìŒ)`);
    }
  });

  // 4. ì—°ê²° ëŠê¹€
  socket.on('disconnect', () => {
    logger.info('í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ëŠê¹€:', socket.id);

    // ëª¨ë‹ˆí„° ì—°ê²° ëŠê¹€ í™•ì¸
    const monitorId = monitorManager.findBySocketId(socket.id);
    if (monitorId) {
      logger.warn(`ëª¨ë‹ˆí„° ì—°ê²° ëŠê¹€: ${monitorId}`);
      monitorManager.release(monitorId);
      // ì£¼ì˜: ëŒ€ê¸°ì—´ì—ì„œ í• ë‹¹í•˜ì§€ ì•ŠìŒ (ëª¨ë‹ˆí„° ì—†ìŒ)
    }

    // ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
    const removed = queueManager.remove(socket.id);
    if (removed) {
      logger.info(`ëŒ€ê¸°ì—´ì—ì„œ ì œê±°: ${socket.id}`);
      // ë‚¨ì€ ëŒ€ê¸°ìë“¤ì—ê²Œ ìˆœì„œ ì—…ë°ì´íŠ¸
      updateQueuePositions();
    }
  });
});

// ============================================
// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// ============================================

/**
 * ëŒ€ê¸°ì—´ ìˆœì„œ ì—…ë°ì´íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸
 */
function updateQueuePositions() {
  const socketIds = queueManager.getAllSocketIds();
  socketIds.forEach((socketId, index) => {
    io.to(socketId).emit('queue-updated', {
      queuePosition: index + 1
    });
  });
}

// ============================================
// ì„œë²„ ì‹œì‘
// ============================================

const PORT = process.env.PORT || 3000;

server.listen(PORT, () => {
  logger.info(`âœ… ì„œë²„ ì‹œì‘: http://localhost:${PORT}`);
  logger.info(`í™˜ê²½: ${process.env.NODE_ENV || 'development'}`);
  logger.info(`CORS: ${process.env.CORS_ORIGIN || '*'}`);
});

// í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì²˜ë¦¬
process.on('SIGTERM', () => {
  logger.info('SIGTERM ìˆ˜ì‹ , ì„œë²„ ì¢…ë£Œ ì¤‘...');
  server.close(() => {
    logger.info('ì„œë²„ ì¢…ë£Œ ì™„ë£Œ');
    process.exit(0);
  });
});

process.on('SIGINT', () => {
  logger.info('SIGINT ìˆ˜ì‹ , ì„œë²„ ì¢…ë£Œ ì¤‘...');
  server.close(() => {
    logger.info('ì„œë²„ ì¢…ë£Œ ì™„ë£Œ');
    process.exit(0);
  });
});
```

---

### 4. logger.js

```javascript
/**
 * ê°„ë‹¨í•œ ë¡œê±°
 */

const logger = {
  info: (message, ...args) => {
    console.log(`[INFO] ${new Date().toISOString()} -`, message, ...args);
  },

  warn: (message, ...args) => {
    console.warn(`[WARN] ${new Date().toISOString()} -`, message, ...args);
  },

  error: (message, ...args) => {
    console.error(`[ERROR] ${new Date().toISOString()} -`, message, ...args);
  }
};

module.exports = logger;
```

---

### 5. constants.js

```javascript
/**
 * ìƒìˆ˜ ì •ì˜
 */

module.exports = {
  MONITOR_IDS: ['monitor-1', 'monitor-2'],
  DEVICE_TYPES: {
    TABLET: 'tablet',
    MONITOR_1: 'monitor-1',
    MONITOR_2: 'monitor-2',
    PROJECTOR: 'projector'
  },
  MONITOR_STATUS: {
    IDLE: 'idle',
    BUSY: 'busy'
  },
  QUEUE_TIMEOUT_MS: 5 * 60 * 1000, // 5ë¶„
  EVENT_NAMES: {
    REGISTER_DEVICE: 'register-device',
    REGISTERED: 'registered',
    REQUEST_MONITOR: 'request-monitor',
    MONITOR_ASSIGNED: 'monitor-assigned',
    START_EXPERIENCE: 'start-experience',
    PLEASE_WAIT: 'please-wait',
    QUEUE_UPDATED: 'queue-updated',
    QUEUE_EXPIRED: 'queue-expired',
    EXPERIENCE_COMPLETE: 'experience-complete',
    ERROR: 'error'
  }
};
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (Postman/ë¸Œë¼ìš°ì € ì½˜ì†”)

#### 1. í—¬ìŠ¤ ì²´í¬

```bash
curl http://localhost:3000/health
```

#### 2. WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸

```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”
const socket = io('http://localhost:3000');

// ëª¨ë‹ˆí„° ë“±ë¡
socket.emit('register-device', 'monitor-1');

// íƒœë¸”ë¦¿ ì—­í• 
socket.emit('request-monitor', { worryId: 'test-123' });

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹
socket.on('monitor-assigned', (data) => {
  console.log('í• ë‹¹ë¨:', data);
});

socket.on('please-wait', (data) => {
  console.log('ëŒ€ê¸°:', data);
});
```

#### 3. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```javascript
// load-test.js
const io = require('socket.io-client');

const NUM_CLIENTS = 10;
const clients = [];

for (let i = 0; i < NUM_CLIENTS; i++) {
  const socket = io('http://localhost:3000');

  socket.on('connect', () => {
    console.log(`í´ë¼ì´ì–¸íŠ¸ ${i} ì—°ê²°`);

    // ëª¨ë‹ˆí„° ìš”ì²­
    setTimeout(() => {
      socket.emit('request-monitor', {
        worryId: `worry-${i}`
      });
    }, Math.random() * 2000);
  });

  socket.on('monitor-assigned', (data) => {
    console.log(`í´ë¼ì´ì–¸íŠ¸ ${i} í• ë‹¹:`, data);
  });

  socket.on('please-wait', (data) => {
    console.log(`í´ë¼ì´ì–¸íŠ¸ ${i} ëŒ€ê¸°:`, data);
  });

  clients.push(socket);
}

// 10ì´ˆ í›„ ì¢…ë£Œ
setTimeout(() => {
  clients.forEach(s => s.disconnect());
  process.exit(0);
}, 10000);
```

---

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

### Railway ë°°í¬

#### 1. GitHub ë ˆí¬ì§€í† ë¦¬ ì—°ê²°

```bash
# Railway í”„ë¡œì íŠ¸ ìƒì„±
# GitHub ë ˆí¬ ì—°ê²°
# server/ í´ë”ë¥¼ ë£¨íŠ¸ë¡œ ì„¤ì •
```

#### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (Railway ëŒ€ì‹œë³´ë“œ)

```bash
PORT=3000
NODE_ENV=production
CORS_ORIGIN=https://ggumddi.vercel.app
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 3. ë¹Œë“œ ì„¤ì •

```json
// package.json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  }
}
```

#### 4. ë°°í¬ í™•ì¸

```bash
# Railway ì œê³µ URL
https://ggumddi-server.up.railway.app

# í—¬ìŠ¤ ì²´í¬
curl https://ggumddi-server.up.railway.app/health
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ í™•ì¸ (Railway)

```bash
# Railway ëŒ€ì‹œë³´ë“œ â†’ Deployments â†’ Logs

# ì£¼ìš” ë¡œê·¸ ì˜ˆì‹œ
[INFO] 2025-01-01T10:00:00.000Z - ì„œë²„ ì‹œì‘: http://localhost:3000
[INFO] 2025-01-01T10:00:05.000Z - í´ë¼ì´ì–¸íŠ¸ ì—°ê²°: abc123
[INFO] 2025-01-01T10:00:06.000Z - ë””ë°”ì´ìŠ¤ ë“±ë¡: monitor-1 (abc123)
[INFO] 2025-01-01T10:00:10.000Z - ëª¨ë‹ˆí„° ìš”ì²­: worryId=67abc, socket=def456
[INFO] 2025-01-01T10:00:10.001Z - ëª¨ë‹ˆí„° í• ë‹¹: monitor-1 â†’ worryId=67abc
```

### ë©”íŠ¸ë¦­ í™•ì¸

```bash
# Railway ëŒ€ì‹œë³´ë“œ â†’ Metrics
- CPU ì‚¬ìš©ë¥ 
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½
```

---

## ğŸ”’ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

* [ ] í™˜ê²½ë³€ìˆ˜ ì•”í˜¸í™” (.env íŒŒì¼ git ì œì™¸)
* [ ] CORS ì œí•œ (Vercel ë„ë©”ì¸ë§Œ)
* [ ] Rate Limiting ê³ ë ¤ (DDoS ë°©ì§€)
* [ ] ì—ëŸ¬ ë©”ì‹œì§€ì— ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€
* [ ] HTTPS ê°•ì œ (Railway ê¸°ë³¸ ì œê³µ)
* [ ] WebSocket ì¸ì¦ (ì„ íƒ, ì „ì‹œì—ëŠ” ë¶ˆí•„ìš”)

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ

* [ ] MonitorManager êµ¬í˜„
* [ ] QueueManager êµ¬í˜„
* [ ] Socket.io ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„
* [ ] í—¬ìŠ¤ ì²´í¬ API
* [ ] ë¡œê¹… ì¶”ê°€
* [ ] ì—ëŸ¬ ì²˜ë¦¬

### í…ŒìŠ¤íŠ¸

* [ ] ë¡œì»¬ ì„œë²„ ì‹¤í–‰ í™•ì¸
* [ ] WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸
* [ ] ëª¨ë‹ˆí„° í• ë‹¹ ë¡œì§ í…ŒìŠ¤íŠ¸
* [ ] ëŒ€ê¸°ì—´ ìˆœì„œ í…ŒìŠ¤íŠ¸
* [ ] ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ (10ëª…)
* [ ] ì—°ê²° ëŠê¹€ ë³µêµ¬ í…ŒìŠ¤íŠ¸

### ë°°í¬

* [ ] Railway í”„ë¡œì íŠ¸ ìƒì„±
* [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì •
* [ ] ë°°í¬ ì„±ê³µ í™•ì¸
* [ ] í—¬ìŠ¤ ì²´í¬ API í™•ì¸
* [ ] ë¡œê·¸ í™•ì¸

### ë¬¸ì„œ

* [ ] README.md ì‘ì„±
* [ ] API ë¬¸ì„œ ì‘ì„±
* [ ] í™˜ê²½ë³€ìˆ˜ ì˜ˆì‹œ (.env.example)

---

## ğŸ“ í•™ìŠµ í‚¤ì›Œë“œ

**Socket.io:**

* WebSocket ì–‘ë°©í–¥ í†µì‹ 
* Room (ì±„ë„ ê°œë…)
* io.to() vs socket.emit()
* ìë™ ì¬ì—°ê²° (reconnection)
* ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 

**Node.js:**

* Express ë¯¸ë“¤ì›¨ì–´
* CORS ì„¤ì •
* í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ (dotenv)
* ë¹„ë™ê¸° ì²˜ë¦¬ (async/await)
* í”„ë¡œì„¸ìŠ¤ ì‹œê·¸ë„ (SIGTERM, SIGINT)

**ìƒíƒœ ê´€ë¦¬:**

* ë©”ëª¨ë¦¬ ê¸°ë°˜ ìƒíƒœ (íœ˜ë°œì„±)
* FIFO í êµ¬í˜„
* íƒ€ì„ì•„ì›ƒ ê´€ë¦¬ (setTimeout, clearTimeout)
* Race Condition ë°©ì§€

**Railway:**

* PaaS (Platform as a Service)
* ìë™ ë°°í¬ (GitHub ì—°ë™)
* í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
* ë¡œê·¸ ëª¨ë‹ˆí„°ë§

---

ì´ ëª…ì„¸ì„œë¥¼ Cursorì— ë¶™ì—¬ë„£ê³  êµ¬í˜„ ì‹œì‘í•˜ë©´ ë¼!

ì¶”ê°€ ì§ˆë¬¸ ìˆì–´?
